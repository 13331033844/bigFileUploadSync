{include file="public_head" /}<!-- upload --><link href="__STATIC__/css/uploads.css" rel="stylesheet"><body class="nav-md"><div class="container body">    <div class="main_container">        {include file="public_sidebar,public_nav" /}        <!-- page content -->        <div class="right_col" role="main">            <div class="">                <div class="page-title">                    <div class="title_left">                        <h3>模板管理</h3>                    </div>                </div>                <div class="clearfix"></div>                <div class="row">                    <div class="col-md-12 col-sm-12 col-xs-12">                        <div class="x_panel">                            <div class="x_content">                                <form class="form-horizontal form-label-left" enctype="multipart/form-data" action="" method="post">                                    <div class="form-group">                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">用户id：</label>                                        <div class="col-md-3 col-sm-6 col-xs-12">                                            <input type="text" placeholder="请填写用户id"                                                   class="form-control col-md-7 col-xs-12" name="member_id" id='member_id'                                                   value="{$item.member_id}"                                            >                                        </div>                                    </div>                                    <div class="divider-dashed"></div>                                                                         <div class="form-group">                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">店铺id：</label>                                        <div class="col-md-3 col-sm-6 col-xs-12">                                            <input type="text" placeholder="请填写公司地址"                                                   class="form-control col-md-7 col-xs-12" name="shop_id" id='shop_id'                                                   value="{$item.shop_id}"                                            >                                        </div>                                    </div>                                    <div class="divider-dashed"></div>                                    <div class="form-group">                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">点赞数：</label>                                        <div class="col-md-3 col-sm-6 col-xs-12">                                            <input type="text" placeholder="请填写"                                                   class="form-control col-md-7 col-xs-12" name="likes" id='likes'                                                   value="{$item.likes}"                                            >                                        </div>                                    </div>                                    <div class="divider-dashed"></div>                                    <div class="form-group">                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">人均消费：</label>                                        <div class="col-md-3 col-sm-6 col-xs-12">                                            <input type="text" placeholder="请填写"                                                   class="form-control col-md-7 col-xs-12" name="average" id='average'                                                   value="{$item.average}"                                            >                                        </div>                                    </div>                                    <div class="divider-dashed"></div>                                    <div class="form-group">                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">浏览量：</label>                                        <div class="col-md-3 col-sm-6 col-xs-12">                                            <input type="text" placeholder="请填写"                                                   class="form-control col-md-7 col-xs-12" name="views" id='views'                                                   value="{$item.views}"                                            >                                        </div>                                    </div>                                    <div class="divider-dashed"></div>                                                                            <div class="form-group">                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">类型：</label>                                        <div class="col-md-3 col-sm-6 col-xs-12">                                            <input type="radio" name='type' value='1' class='radiotype' {if condition="$item.type == 1"}checked{/if} style="zoom:1.5;">动态                                            <input type="radio" name='type' value='2' class='radiotype' {if condition="$item.type == 2"}checked{/if} style="zoom:1.5;">视频                                        </div>                                    </div>                                                                        <div class="divider-dashed"></div>                                    <div class="form-group hidden2">                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">图片上传：</label>                                        <div class="col-md-6 col-sm-6 col-xs-12">                                            <div id="uploader" class="wu-example">                                                <div id="uploader-demo">                                                                                                        <textarea name="image" class="img_url" cols="200" rows="5" width="500px">{$item.image}</textarea>                                                    <input type="file" class='imagelist'/> <br>                                                 </div>                                            </div>                                                                                                                            </div>                                        <div id='show_img'>                                            <!-- <img width="100px" src="{$item.url}"> -->                                            <!-- <span class="btn btn-primary" id='add'>增加图片</span> -->                                        </div>                                    </div>                                    <div class="divider-dashed"></div>                                    <div class="form-group hidden1">                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">视频上传：</label>                                        <div class="col-md-6 col-sm-6 col-xs-12">                                            <input type="text" name="mov" class="mov_url form-control col-md-7 col-xs-12" value="{$item.mov}">                                            <input type="file" id="file_upload_mov">                                            <span class="btn btn-primary" id='upload_mov'>上传</span>                                            <span class="cent"></span>                                                                                    </div>                                                                           </div>                                    <div class="ln_solid"></div>                                    <div class="form-group">                                        <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">                                            <button type="submit" class="btn btn-primary" id='sub'>提交</button>                                            <a type="reset" class="btn btn-success" onclick="history.go(-1)">返回</a>                                        </div>                                    </div>                                </form>                            </div>                        </div>                    </div>                </div>            </div>            <!-- /page content -->        </div>    </div></div>{include file="public_foot" /}<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script><script>        $('#add').click(function() {            $('#uploader-demo').append('<input type="file" class="imagelist"/><br>')        })        function Upload() {            const LENGTH = 2 * 1024 * 1024; // 单片长度            var start = 0;  //开始点位            var end = start + LENGTH; //单片结束点位            var blob;//全局二进制变量            var blob_num = 1;//二进制变量标号            var arr = [] //切片点位数组            var stamp  //时间戳变量            var cent   //百分比分子变量            var is_msg = 0 //是否提示过alert变量            //对外方法，传入文件对象            this.addFileAndSend = function(that) {                var file = that.files[0];                while (true) {                    if (start < file.size) {                        if (end > file.size) {                            end = file.size                        }                        arr.push({                            start : start,                            end : end                        })                        start = end;                        end = start + LENGTH;                    } else {                        break;                    }                }            }            //切割文件            function cutFile(file, start, end) {                var file_blob = file.slice(start, end);                return file_blob;            }            this.confirm_mov = function(that) {                if (arr.length == 0) {                    alert("请选择文件。")                    return false                }                cent = 0                var file = that.files[0];                stamp = new Date().getTime()                for (var i = 0; i < arr.length; i++) {                    blob_num = i + 1;                    sendFile(file, arr[i].start, arr[i].end, blob_num);                }            }            // 发送文件            function sendFile(file, start, end, blob_num) {                var total_blob_num = Math.ceil(file.size / LENGTH);                blob = cutFile(file, start, end);                // 修改文件名                var spl = file.name.split(".");                filename = md5(file.name) + "_" + stamp + "."                        + spl[spl.length - 1]                var form_data = new FormData();                // 填写数据                form_data.set('file', blob);                form_data.set('blob_num', blob_num);                form_data.set('total_blob_num', total_blob_num);                form_data.set('file_name', filename);                $.ajax({                    url : '/interfaces/uploadvideo/uploadvideo',                    type : 'post',                    processData : false,                    contentType : false,                    async : true,                    data : form_data,                    dataType : 'json',                    success : function(data) {                        if (data.code != 0) {                            cent++                            $('.cent').html(cent / total_blob_num * 100 + '%')                            console.log(cent + '/' + total_blob_num                                    + data.file_path)                            if (data.code == 2) {                                $('.mov_url').val(data.file_path)                            }                        } else {                            if (is_msg == 0) {                                alert("上传错误，联系开发")                            }                            is_msg = 1                        }                    }                })            }        }        var upload = new Upload();        var fileForm = document.getElementById("file_upload_mov");        fileForm.onchange = function() {            upload.addFileAndSend(this);        }        $("#upload_mov").click(function() {            upload.confirm_mov(fileForm);        })                function fileLoad(ele){                  //④创建一个formData对象                var formData = new FormData();                //⑤获取传入元素的val                var name = $(ele).val();                  //⑥获取files                var files = $(ele)[0].files[0];                //⑦将name 和 files 添加到formData中，键值对形式                formData.set("file", files);                formData.set("name", name);                                $.ajax({                    url: '{:url("console/Videos/uploadImg")}',                    type: 'POST',                    data: formData,                    processData: false,// ⑧告诉jQuery不要去处理发送的数据                    contentType: false, // ⑨告诉jQuery不要去设置Content-Type请求头                    dataType : 'json',                    success: function (data) {                        if (data.status == 'success') {                            $('.img_url').val($('.img_url').val() +",/newload/"+data.msg);                        }                        alert("成功啦");                    }                    ,                    error : function (responseStr) {                        //12出错后的动作                        alert("出错啦");                    }                });            }            $(function () {                choice({$item.type})                var $input =  $(".imagelist");                // ①为input设定change事件                $input.change(function () {                //    ②如果value不为空，调用文件加载方法                    if($(this).val() != ""){                        fileLoad(this);                    }                })            })            $('.radiotype').click(function(){                v = $(this).val()                choice(v)            })            function choice(that){                if(that==1){                    $('.hidden1').hide()                    $('.hidden2').show()                }else if(that==2){                    $('.hidden2').hide()                    $('.hidden1').show()                }else{                    $('.hidden1').hide()                    $('.hidden2').hide()                }            }            $('#sub').click(function(){                var member_id = $('#member_id').val()                var shop_id = $('#shop_id').val()                var img_url = $('.img_url').val()                var mov_url = $('.mov_url').val()                var type = $("input[type='radio']:checked").val();                if (!member_id) {                    alert("未填写用户")                    return false                }                if (!shop_id) {                    alert("未填写店铺")                    return false                }                if (!img_url && type ==1) {                    alert("未上传图片素材")                    return false                }                if (!mov_url && type ==2) {                     alert("未上传视频素材")                    return false                }            })</script></body></html>